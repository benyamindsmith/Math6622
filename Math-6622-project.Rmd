---
title: "Math 6620 Project"
author: "Benjamin Smith and Omesh Chandan"
date: "2/25/2021"
output:
  word_document: default
  html_document: default
---
## Introduction 

The sinking of the Titanic is one of the most infamous shipwrecks in history.

  On April 15, 1912, during her maiden voyage, the widely considered “unsinkable” RMS Titanic sank after colliding with an iceberg. Unfortunately, there were not enough lifeboats for everyone on board, resulting in the death of 1502 out of 2224 passengers and crew. While there was some element of luck involved in surviving, it seems some groups of people were more likely to survive than others.
  
  In this report we will explore the data set on the passengers of the Titanic and determine what are the key factors for predicting passenger survival. After this we will proceed with showing a developed model and examine the necessary diagnostics.

## The Data

  The data set is an openly available on [Kaggle.com](https://www.kaggle.com/c/titanic/overview) as one of their available competitions. However, make this analysis as reproducible as possible we have downloaded the the data with the `readr` package from the gist posted by Micheleen Harris ([here](https://gist.github.com/michhar/2dfd2de0d4f8727f873422c5d959fff5)).  

The data set consists of 12 variables. The data dictionary is posted with the [data description on the Kaggle site](https://www.kaggle.com/c/titanic/data). For convenience it will be written here to provide a description each variable.

### Data Dictionary

* PassengerId : Id assigned  to each passenger

* Survived:	Survival	0 = No, 1 = Yes

* Pclass:	Ticket class	1 = 1st, 2 = 2nd, 3 = 3rd

* Name: Name of the passenger

* Sex:	Sex	of the passenger

* Age:	Age of the passenger in years	

* SibSp:	# of siblings / spouses aboard the Titanic	

* Parch:	# of parents / children aboard the Titanic	

* Ticket:	Ticket number	

* Fare:	Passenger fare	

* Cabin:	Cabin number	

* Embarked:	Port of Embarkation	C = Cherbourg, Q = Queenstown, S = Southampton

## Exploratory Data Analysis

Before constructing a model, we should examine the relationships present between the various variables, survival and their various interactions. With this we can choose which parameters would be suitable. With this in mind the following visuals are created as part of the EDA to provide insight on what variables would be suitable for constructing a model for predicting passenger survival.

```{r message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
# Read data from online
df<- readr::read_csv("https://gist.githubusercontent.com/michhar/2dfd2de0d4f8727f873422c5d959fff5/raw/fa71405126017e6a37bea592440b4bee94bf7b9e/titanic.csv")
```


### Questions

The questions we are interesting in answering with this exploratory data analysis are:

  1. How much data is missing in this dataset?

  2. Is there a higher probability of survival depending on a passenger's sex?
  
  3. Is there a higher probability of survival depending on ticket class?

  4. Is age a determining factor for survival?
  
  5. Does a passenger having an immediate family member (i.e. a spouse, sibling(s), parent(s) and/or children) with them improve their probability for survival?

  6. How does the interaction of these variables relate to survival on the Titanic?  

### Missing Data

Before examining the data it is important to first see what data is missing. Even if there is no treatment done to the missing data, awareness of missing data for a given variable is important to know about before adding it as a variable to our model. 

Using the `naniar` package we are able to visualize the proportion of data missing in each variable field.

```{r echo=FALSE}
library(naniar)

miss_var_summary(df)

vis_miss(df)
```

In the entire data set, 8.1% of the data is missing. Missing data is present in the `Cabin` (77.1%), `Age` (19.87%) and `Embarked` (0.22%) fields. While it is possible to use the data present in `Cabin` if we understand its context (see [here](https://titanic.fandom.com/wiki/First_Class_Staterooms) and [here](https://www.encyclopedia-titanica.org/cabins.html)) it will require some data wrangling and classification which is beyond the scope of this report.   

With the missing data acknowledged, lets will proceed with looking at the relationships with various variables and passenger survival.


### Sex of Passenger and Survival
```{r echo=FALSE, message=FALSE, warning=FALSE}
survivalProp <- df %>% group_by(Sex,Survived) %>% 
  summarize(count=n()) %>% 
  mutate(pct=count/sum(count),Count=count)

ggplot(data=survivalProp,mapping=aes(x=Sex,y=pct,fill=as.factor(Survived)))+
  geom_bar(stat="identity",position="fill")+
  geom_text(mapping= aes(label=scales::percent(pct)),position="stack",size=3, vjust=+2.5)+
  geom_text(mapping= aes(label=paste("Count:",Count)),position="stack",size=3, vjust=+3.8)+
  scale_fill_manual(name="Survived",
                    values=c("#F8766D","#00BFC4"),
                    labels=c("Yes","No"))+
  labs(title="Survival on The Titanic",subtitle = "Male vs Female")+
  theme(plot.title = element_text(hjust=0.5),plot.subtitle = element_text(hjust=0.5))
```

Overall, women on the Titanic were 3.9 times more likely to survive than men. Men on the Titanic were  3.1 times more likely to die than women.

### Ticket Class of Passenger and Survival

```{r echo=FALSE, message=FALSE, warning=FALSE}
PclassProp<-df %>% group_by(Pclass,Survived)%>% 
  summarize(count=n()) %>% 
  mutate(pct=count/sum(count),Count=count)

ggplot(data=PclassProp,mapping=aes(x=Pclass,y=pct,fill=as.factor(Survived)))+
  geom_bar(stat="identity",position="fill")+
  geom_text(mapping= aes(label=scales::percent(pct)),position="stack",size=3, vjust=+2.5)+
  geom_text(mapping= aes(label=paste("Count:",Count)),position="stack",size=3, vjust=+3.8)+
  scale_fill_manual(name="Survived",
                    values=c("#F8766D","#00BFC4"),
                    labels=c("No","Yes"))+
  labs(title="Survival on The Titanic",subtitle = "Based On Ticket Class")+
  theme(plot.title = element_text(hjust=0.5),plot.subtitle = element_text(hjust=0.5))
```

  Passengers in first class had the highest probability of surviving followed by those in second and third class. Passengers in first class were 1.3 times more likely to survive than passengers in second class and were 2.6 times more likely to survive than passengers in third class. 

  Passengers in third class were 1.4 times more likely to die than passengers on second class and were over 2 times more likely to die than passengers in first class.

### Age and Survival

```{r echo=FALSE, message=FALSE, warning=FALSE}

df$SurvivedFactor<-as.factor(df$Survived)
levels(df$SurvivedFactor)<-c("Did not Survive","Survived")

ggplot(data=df,mapping=aes(x=Age))+
  geom_histogram(bins=20)+
  facet_grid(~SurvivedFactor)+
  labs(title="Age Distribution on the Titanic",subtitle = "Based on Survival")+
  theme(legend.position = "none")+
  theme(plot.title = element_text(hjust=0.5),plot.subtitle = element_text(hjust=0.5))

```
Looking at the distribution of age alone. There does not seem to be any outstanding relationship between age and survival. 

### Number of passenger relatives and survival.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ParchProp<-df %>% group_by(Parch,Survived)%>% 
  summarize(count=n()) %>% 
  mutate(pct=count/sum(count),Count=count)

SibSpProp<-df %>% group_by(SibSp,Survived)%>% 
  summarize(count=n()) %>% 
  mutate(pct=count/sum(count),Count=count)

ggplot(data=ParchProp,mapping=aes(x=Parch,y=pct,fill=as.factor(Survived)))+
  geom_bar(stat="identity",position="fill")+
  geom_text(mapping= aes(label=scales::percent(pct)),position="stack",size=3, vjust=+2.5)+
  geom_text(mapping= aes(label=paste("Count:",Count)),position="stack",size=3, vjust=+5.5)+
  scale_fill_manual(name="Survived",
                    values=c("#F8766D","#00BFC4"),
                    labels=c("No","Yes"))+
  labs(title="Survival on The Titanic",subtitle = "Based On Number of Parents\nand/or Children Present with Passenger")+
  theme(plot.title = element_text(hjust=0.5),plot.subtitle = element_text(hjust=0.5))

ggplot(data=SibSpProp,mapping=aes(x=SibSp,y=pct,fill=as.factor(Survived)))+
  geom_bar(stat="identity",position="fill")+
  geom_text(mapping= aes(label=scales::percent(pct)),position="stack",size=3, vjust=+2.5)+
  geom_text(mapping= aes(label=paste("Count:",Count)),position="stack",size=3, vjust=+5.5)+
  scale_fill_manual(name="Survived",
                    values=c("#F8766D","#00BFC4"),
                    labels=c("No","Yes"))+
  labs(title="Survival on The Titanic",subtitle = "Based On Number of Siblings\nand/or Spouse Present with Passenger")+
  theme(plot.title = element_text(hjust=0.5),plot.subtitle = element_text(hjust=0.5))
```
Based on both these charts having/not having a spouse, sibling parent or child with an individual has an effect on the probability of survival. 

# THIS IS A MESS HERE DON'T LOOK 

# Exploratory Data Analysis

```{r}
library(tidyverse)
survivalProp <- df %>% group_by(Sex,Survived) %>% 
  summarize(count=n()) %>% 
  mutate(pct=count/sum(count),Count=count)

PclassProp<-df %>% group_by(Pclass,Survived)%>% 
  summarize(count=n()) %>% 
  mutate(pct=count/sum(count),Count=count)

ParchProp<-df %>% group_by(Parch,Survived)%>% 
  summarize(count=n()) %>% 
  mutate(pct=count/sum(count),Count=count)

SibSpProp<-df %>% group_by(SibSp,Survived)%>% 
  summarize(count=n()) %>% 
  mutate(pct=count/sum(count),Count=count)

ggplot(data=survivalProp,mapping=aes(x=Sex,y=pct,fill=as.factor(Survived)))+
  geom_bar(stat="identity",position="fill")+
  geom_text(mapping= aes(label=scales::percent(pct)),position="stack",size=3, vjust=+2.5)+
  geom_text(mapping= aes(label=paste("Count:",Count)),position="stack",size=3, vjust=+5.5)+
  scale_fill_manual(name="Survived",
                    values=c("#F8766D","#00BFC4"),
                    labels=c("Yes","No"))+
  labs(title="Survival on The Titanic",subtitle = "Male vs Female")+
  theme(plot.title = element_text(hjust=0.5),plot.subtitle = element_text(hjust=0.5))

ggplot(data=PclassProp,mapping=aes(x=Pclass,y=pct,fill=as.factor(Survived)))+
  geom_bar(stat="identity",position="fill")+
  geom_text(mapping= aes(label=scales::percent(pct)),position="stack",size=3, vjust=+2.5)+
  geom_text(mapping= aes(label=paste("Count:",Count)),position="stack",size=3, vjust=+5.5)+
  scale_fill_manual(name="Survived",
                    values=c("#F8766D","#00BFC4"),
                    labels=c("No","Yes"))+
  labs(title="Survival on The Titanic",subtitle = "Based On Ticket Class")+
  theme(plot.title = element_text(hjust=0.5),plot.subtitle = element_text(hjust=0.5))


ggplot(data=ParchProp,mapping=aes(x=Parch,y=pct,fill=as.factor(Survived)))+
  geom_bar(stat="identity",position="fill")+
  geom_text(mapping= aes(label=scales::percent(pct)),position="stack",size=3, vjust=+2.5)+
  geom_text(mapping= aes(label=paste("Count:",Count)),position="stack",size=3, vjust=+5.5)+
  scale_fill_manual(name="Survived",
                    values=c("#F8766D","#00BFC4"),
                    labels=c("No","Yes"))+
  labs(title="Survival on The Titanic",subtitle = "Based On Number of Parents and/or Children Present with Passenger")+
  theme(plot.title = element_text(hjust=0.5),plot.subtitle = element_text(hjust=0.5))

ggplot(data=SibSpProp,mapping=aes(x=SibSp,y=pct,fill=as.factor(Survived)))+
  geom_bar(stat="identity",position="fill")+
  geom_text(mapping= aes(label=scales::percent(pct)),position="stack",size=3, vjust=+2.5)+
  geom_text(mapping= aes(label=paste("Count:",Count)),position="stack",size=3, vjust=+5.5)+
  scale_fill_manual(name="Survived",
                    values=c("#F8766D","#00BFC4"),
                    labels=c("No","Yes"))+
  labs(title="Survival on The Titanic",subtitle = "Based On Number of Siblings and/or Spouse Present with Passenger")+
  theme(plot.title = element_text(hjust=0.5),plot.subtitle = element_text(hjust=0.5))
```

```{r}
# This is altered from original
survivalProp <- df %>% group_by(Sex,Pclass,Survived) %>% 
  summarize(count=n()) %>% 
  mutate(pct=count/sum(count),Count=count)

SibSpProp<-df %>% group_by(SibSp,Sex,Survived)%>% 
  summarize(count=n()) %>% 
  mutate(pct=count/sum(count),Count=count)

ggplot(data=df,mapping=aes(x=Age,fill=Sex))+
  geom_histogram(bins=20)+
  facet_grid(~Sex)+
  labs(title="Age Distribution on the Titanic",subtitle = "by Sex")+
  theme(legend.position = "none")+
  theme(plot.title = element_text(hjust=0.5),plot.subtitle = element_text(hjust=0.5))

ggplot(data=df,mapping=aes(x=Age,fill=Sex))+
  geom_histogram(bins=20)+
  facet_grid(Sex~Survived)+
  labs(title="Age Distribution on the Titanic and Survival",subtitle = "by Sex")+
  theme(legend.position = "none")+
  theme(plot.title = element_text(hjust=0.5),plot.subtitle = element_text(hjust=0.5))

ggplot(data=df,mapping=aes(x=Age,fill=Sex))+
  geom_histogram(bins=20)+
  facet_grid(Pclass~Survived)+
  labs(title="Age Distribution on the Titanic based on  Survival",subtitle = "by Sex and Ticket Class")+
  theme(plot.title = element_text(hjust=0.5),plot.subtitle = element_text(hjust=0.5))


ggplot(data=survivalProp,mapping=aes(x=Sex,y=pct,fill=as.factor(Survived)))+
  geom_bar(stat="identity",position="fill")+
  facet_grid(~Pclass)+
  geom_text(mapping= aes(label=scales::percent(pct)),position="stack",size=3, vjust=0.75)+
  scale_fill_manual(name="Survived",
                    values=c("#F8766D","#00BFC4"),
                    labels=c("Yes","No"))+
  labs(title="Survival on The Titanic",subtitle = "Male vs Female, by Ticket Class")+
  theme(plot.title = element_text(hjust=0.5),plot.subtitle = element_text(hjust=0.5))


ggplot(data=SibSpProp,mapping=aes(x=SibSp,y=pct,fill=as.factor(Survived)))+
  geom_bar(stat="identity",position="fill")+
  facet_grid(~Sex)+
  geom_text(mapping= aes(label=Count),position="stack",size=3, vjust=+1.5)+
  scale_fill_manual(name="Survived",
                    values=c("#F8766D","#00BFC4"),
                    labels=c("No","Yes"))+
  labs(title="Survival on The Titanic",subtitle = "Based On Number of Siblings and/or Spouse Present with Passenger and Sex")+
  theme(plot.title = element_text(hjust=0.5),plot.subtitle = element_text(hjust=0.5))
```


